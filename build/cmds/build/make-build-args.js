const R = require('ramda');

var _require = require('os');

const getHomedir = _require.homedir;

const expandTilde = require('expand-tilde');
const Transform = require('../../lib/transform-docker-options');

const propTransforms = {
  tags: value => {
    return value.map(v => {
      if (Array.isArray(v)) {
        return R.flatten(v.map(tag => ['--tag', tag]));
      } else {
        return ['--tag', v];
      }
    });
  },
  args: R.pipe(R.toPairs, R.map(([key, value]) => ['--build-arg', `${ key }=${ value }`]))
};

const makeBuildArgs = (config = {}, dirs = {
  cwd: process.cwd(),
  homedir: getHomedir()
}) => {
  const transform = Transform(propTransforms, dirs);
  if (config.file) {
    config.file = expandTilde(config.file);
  }
  const buildArgs = transform(R.omit(['context'], config));
  const context = expandTilde(config.context || './');
  return ['build', ...buildArgs, context];
};

module.exports = makeBuildArgs;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jbWRzL2J1aWxkL21ha2UtYnVpbGQtYXJncy5qcyJdLCJuYW1lcyI6WyJSIiwicmVxdWlyZSIsImdldEhvbWVkaXIiLCJob21lZGlyIiwiZXhwYW5kVGlsZGUiLCJUcmFuc2Zvcm0iLCJwcm9wVHJhbnNmb3JtcyIsInRhZ3MiLCJ2YWx1ZSIsIm1hcCIsInYiLCJBcnJheSIsImlzQXJyYXkiLCJmbGF0dGVuIiwidGFnIiwiYXJncyIsInBpcGUiLCJ0b1BhaXJzIiwia2V5IiwibWFrZUJ1aWxkQXJncyIsImNvbmZpZyIsImRpcnMiLCJjd2QiLCJwcm9jZXNzIiwidHJhbnNmb3JtIiwiZmlsZSIsImJ1aWxkQXJncyIsIm9taXQiLCJjb250ZXh0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsSUFBSUMsUUFBUSxPQUFSLENBQVY7O2VBQzhCQSxRQUFRLElBQVIsQzs7TUFBZEMsVSxZQUFUQyxPOztBQUNQLE1BQU1DLGNBQWNILFFBQVEsY0FBUixDQUFwQjtBQUNBLE1BQU1JLFlBQVlKLFFBQVEsb0NBQVIsQ0FBbEI7O0FBRUEsTUFBTUssaUJBQWlCO0FBQ3JCQyxRQUFNQyxTQUFTO0FBQ2IsV0FBT0EsTUFBTUMsR0FBTixDQUFVQyxLQUFLO0FBQ3BCLFVBQUlDLE1BQU1DLE9BQU4sQ0FBY0YsQ0FBZCxDQUFKLEVBQXNCO0FBQ3BCLGVBQU9WLEVBQUVhLE9BQUYsQ0FBVUgsRUFBRUQsR0FBRixDQUFNSyxPQUFPLENBQUMsT0FBRCxFQUFVQSxHQUFWLENBQWIsQ0FBVixDQUFQO0FBQ0QsT0FGRCxNQUVPO0FBQ0wsZUFBTyxDQUFDLE9BQUQsRUFBVUosQ0FBVixDQUFQO0FBQ0Q7QUFDRixLQU5NLENBQVA7QUFPRCxHQVRvQjtBQVVyQkssUUFBTWYsRUFBRWdCLElBQUYsQ0FDSmhCLEVBQUVpQixPQURFLEVBRUpqQixFQUFFUyxHQUFGLENBQU0sQ0FBQyxDQUFDUyxHQUFELEVBQU1WLEtBQU4sQ0FBRCxLQUFrQixDQUFDLGFBQUQsRUFBaUIsSUFBRVUsR0FBSSxNQUFHVixLQUFNLEdBQWhDLENBQXhCLENBRkk7QUFWZSxDQUF2Qjs7QUFnQkEsTUFBTVcsZ0JBQWdCLENBQ3BCQyxTQUFTLEVBRFcsRUFFcEJDLE9BQU87QUFDTEMsT0FBS0MsUUFBUUQsR0FBUixFQURBO0FBRUxuQixXQUFTRDtBQUZKLENBRmEsS0FNakI7QUFDSCxRQUFNc0IsWUFBWW5CLFVBQVVDLGNBQVYsRUFBMEJlLElBQTFCLENBQWxCO0FBQ0EsTUFBSUQsT0FBT0ssSUFBWCxFQUFpQjtBQUNmTCxXQUFPSyxJQUFQLEdBQWNyQixZQUFZZ0IsT0FBT0ssSUFBbkIsQ0FBZDtBQUNEO0FBQ0QsUUFBTUMsWUFBWUYsVUFBVXhCLEVBQUUyQixJQUFGLENBQU8sQ0FBQyxTQUFELENBQVAsRUFBb0JQLE1BQXBCLENBQVYsQ0FBbEI7QUFDQSxRQUFNUSxVQUFVeEIsWUFBWWdCLE9BQU9RLE9BQVAsSUFBa0IsSUFBOUIsQ0FBaEI7QUFDQSxTQUFPLENBQUMsT0FBRCxFQUFVLEdBQUdGLFNBQWIsRUFBd0JFLE9BQXhCLENBQVA7QUFDRCxDQWREOztBQWdCQUMsT0FBT0MsT0FBUCxHQUFpQlgsYUFBakIiLCJmaWxlIjoibWFrZS1idWlsZC1hcmdzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUiA9IHJlcXVpcmUoJ3JhbWRhJylcbmNvbnN0IHtob21lZGlyOiBnZXRIb21lZGlyfSA9IHJlcXVpcmUoJ29zJylcbmNvbnN0IGV4cGFuZFRpbGRlID0gcmVxdWlyZSgnZXhwYW5kLXRpbGRlJylcbmNvbnN0IFRyYW5zZm9ybSA9IHJlcXVpcmUoJ34vbGliL3RyYW5zZm9ybS1kb2NrZXItb3B0aW9ucycpXG5cbmNvbnN0IHByb3BUcmFuc2Zvcm1zID0ge1xuICB0YWdzOiB2YWx1ZSA9PiB7XG4gICAgcmV0dXJuIHZhbHVlLm1hcCh2ID0+IHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHYpKSB7XG4gICAgICAgIHJldHVybiBSLmZsYXR0ZW4odi5tYXAodGFnID0+IFsnLS10YWcnLCB0YWddKSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBbJy0tdGFnJywgdl1cbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBhcmdzOiBSLnBpcGUoXG4gICAgUi50b1BhaXJzLFxuICAgIFIubWFwKChba2V5LCB2YWx1ZV0pID0+IFsnLS1idWlsZC1hcmcnLCBgJHtrZXl9PSR7dmFsdWV9YF0pXG4gIClcbn1cblxuY29uc3QgbWFrZUJ1aWxkQXJncyA9IChcbiAgY29uZmlnID0ge30sXG4gIGRpcnMgPSB7XG4gICAgY3dkOiBwcm9jZXNzLmN3ZCgpLFxuICAgIGhvbWVkaXI6IGdldEhvbWVkaXIoKVxuICB9XG4pID0+IHtcbiAgY29uc3QgdHJhbnNmb3JtID0gVHJhbnNmb3JtKHByb3BUcmFuc2Zvcm1zLCBkaXJzKVxuICBpZiAoY29uZmlnLmZpbGUpIHtcbiAgICBjb25maWcuZmlsZSA9IGV4cGFuZFRpbGRlKGNvbmZpZy5maWxlKVxuICB9XG4gIGNvbnN0IGJ1aWxkQXJncyA9IHRyYW5zZm9ybShSLm9taXQoWydjb250ZXh0J10sIGNvbmZpZykpXG4gIGNvbnN0IGNvbnRleHQgPSBleHBhbmRUaWxkZShjb25maWcuY29udGV4dCB8fCAnLi8nKVxuICByZXR1cm4gWydidWlsZCcsIC4uLmJ1aWxkQXJncywgY29udGV4dF1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBtYWtlQnVpbGRBcmdzXG4iXX0=