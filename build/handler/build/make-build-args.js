const R = require('ramda');

var _require = require('os');

const getHomedir = _require.homedir;

const expandTilde = require('expand-tilde');
const Transform = require('../../lib/transform-docker-options');

const propTransforms = {
  tag: value => {
    return value.map(v => {
      if (Array.isArray(v)) {
        return R.flatten(v.map(tag => ['--tag', tag]));
      } else {
        return ['--tag', v];
      }
    });
  },
  args: R.pipe(R.toPairs, R.map(([key, value]) => ['--build-arg', `${ key }=${ value }`]))
};

const makeBuildArgs = (config = {}, dirs = {
  cwd: process.cwd(),
  homedir: getHomedir()
}) => {
  const transform = Transform(propTransforms, dirs);
  if (config.file) {
    config.file = expandTilde(config.file);
  }
  const buildArgs = transform(R.omit(['context'], config));
  const context = expandTilde(config.context || './');
  return [...buildArgs, context];
};

module.exports = makeBuildArgs;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9oYW5kbGVyL2J1aWxkL21ha2UtYnVpbGQtYXJncy5qcyJdLCJuYW1lcyI6WyJSIiwicmVxdWlyZSIsImdldEhvbWVkaXIiLCJob21lZGlyIiwiZXhwYW5kVGlsZGUiLCJUcmFuc2Zvcm0iLCJwcm9wVHJhbnNmb3JtcyIsInRhZyIsInZhbHVlIiwibWFwIiwidiIsIkFycmF5IiwiaXNBcnJheSIsImZsYXR0ZW4iLCJhcmdzIiwicGlwZSIsInRvUGFpcnMiLCJrZXkiLCJtYWtlQnVpbGRBcmdzIiwiY29uZmlnIiwiZGlycyIsImN3ZCIsInByb2Nlc3MiLCJ0cmFuc2Zvcm0iLCJmaWxlIiwiYnVpbGRBcmdzIiwib21pdCIsImNvbnRleHQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxJQUFJQyxRQUFRLE9BQVIsQ0FBVjs7ZUFDOEJBLFFBQVEsSUFBUixDOztNQUFkQyxVLFlBQVRDLE87O0FBQ1AsTUFBTUMsY0FBY0gsUUFBUSxjQUFSLENBQXBCO0FBQ0EsTUFBTUksWUFBWUosUUFBUSxvQ0FBUixDQUFsQjs7QUFFQSxNQUFNSyxpQkFBaUI7QUFDckJDLE9BQUtDLFNBQVM7QUFDWixXQUFPQSxNQUFNQyxHQUFOLENBQVVDLEtBQUs7QUFDcEIsVUFBSUMsTUFBTUMsT0FBTixDQUFjRixDQUFkLENBQUosRUFBc0I7QUFDcEIsZUFBT1YsRUFBRWEsT0FBRixDQUFVSCxFQUFFRCxHQUFGLENBQU1GLE9BQU8sQ0FBQyxPQUFELEVBQVVBLEdBQVYsQ0FBYixDQUFWLENBQVA7QUFDRCxPQUZELE1BRU87QUFDTCxlQUFPLENBQUMsT0FBRCxFQUFVRyxDQUFWLENBQVA7QUFDRDtBQUNGLEtBTk0sQ0FBUDtBQU9ELEdBVG9CO0FBVXJCSSxRQUFNZCxFQUFFZSxJQUFGLENBQ0pmLEVBQUVnQixPQURFLEVBRUpoQixFQUFFUyxHQUFGLENBQU0sQ0FBQyxDQUFDUSxHQUFELEVBQU1ULEtBQU4sQ0FBRCxLQUFrQixDQUFDLGFBQUQsRUFBaUIsSUFBRVMsR0FBSSxNQUFHVCxLQUFNLEdBQWhDLENBQXhCLENBRkk7QUFWZSxDQUF2Qjs7QUFnQkEsTUFBTVUsZ0JBQWdCLENBQ3BCQyxTQUFTLEVBRFcsRUFFcEJDLE9BQU87QUFDTEMsT0FBS0MsUUFBUUQsR0FBUixFQURBO0FBRUxsQixXQUFTRDtBQUZKLENBRmEsS0FNakI7QUFDSCxRQUFNcUIsWUFBWWxCLFVBQVVDLGNBQVYsRUFBMEJjLElBQTFCLENBQWxCO0FBQ0EsTUFBSUQsT0FBT0ssSUFBWCxFQUFpQjtBQUNmTCxXQUFPSyxJQUFQLEdBQWNwQixZQUFZZSxPQUFPSyxJQUFuQixDQUFkO0FBQ0Q7QUFDRCxRQUFNQyxZQUFZRixVQUFVdkIsRUFBRTBCLElBQUYsQ0FBTyxDQUFDLFNBQUQsQ0FBUCxFQUFvQlAsTUFBcEIsQ0FBVixDQUFsQjtBQUNBLFFBQU1RLFVBQVV2QixZQUFZZSxPQUFPUSxPQUFQLElBQWtCLElBQTlCLENBQWhCO0FBQ0EsU0FBTyxDQUFDLEdBQUdGLFNBQUosRUFBZUUsT0FBZixDQUFQO0FBQ0QsQ0FkRDs7QUFnQkFDLE9BQU9DLE9BQVAsR0FBaUJYLGFBQWpCIiwiZmlsZSI6Im1ha2UtYnVpbGQtYXJncy5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFIgPSByZXF1aXJlKCdyYW1kYScpXG5jb25zdCB7aG9tZWRpcjogZ2V0SG9tZWRpcn0gPSByZXF1aXJlKCdvcycpXG5jb25zdCBleHBhbmRUaWxkZSA9IHJlcXVpcmUoJ2V4cGFuZC10aWxkZScpXG5jb25zdCBUcmFuc2Zvcm0gPSByZXF1aXJlKCd+L2xpYi90cmFuc2Zvcm0tZG9ja2VyLW9wdGlvbnMnKVxuXG5jb25zdCBwcm9wVHJhbnNmb3JtcyA9IHtcbiAgdGFnOiB2YWx1ZSA9PiB7XG4gICAgcmV0dXJuIHZhbHVlLm1hcCh2ID0+IHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHYpKSB7XG4gICAgICAgIHJldHVybiBSLmZsYXR0ZW4odi5tYXAodGFnID0+IFsnLS10YWcnLCB0YWddKSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBbJy0tdGFnJywgdl1cbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBhcmdzOiBSLnBpcGUoXG4gICAgUi50b1BhaXJzLFxuICAgIFIubWFwKChba2V5LCB2YWx1ZV0pID0+IFsnLS1idWlsZC1hcmcnLCBgJHtrZXl9PSR7dmFsdWV9YF0pXG4gIClcbn1cblxuY29uc3QgbWFrZUJ1aWxkQXJncyA9IChcbiAgY29uZmlnID0ge30sXG4gIGRpcnMgPSB7XG4gICAgY3dkOiBwcm9jZXNzLmN3ZCgpLFxuICAgIGhvbWVkaXI6IGdldEhvbWVkaXIoKVxuICB9XG4pID0+IHtcbiAgY29uc3QgdHJhbnNmb3JtID0gVHJhbnNmb3JtKHByb3BUcmFuc2Zvcm1zLCBkaXJzKVxuICBpZiAoY29uZmlnLmZpbGUpIHtcbiAgICBjb25maWcuZmlsZSA9IGV4cGFuZFRpbGRlKGNvbmZpZy5maWxlKVxuICB9XG4gIGNvbnN0IGJ1aWxkQXJncyA9IHRyYW5zZm9ybShSLm9taXQoWydjb250ZXh0J10sIGNvbmZpZykpXG4gIGNvbnN0IGNvbnRleHQgPSBleHBhbmRUaWxkZShjb25maWcuY29udGV4dCB8fCAnLi8nKVxuICByZXR1cm4gWy4uLmJ1aWxkQXJncywgY29udGV4dF1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBtYWtlQnVpbGRBcmdzXG4iXX0=