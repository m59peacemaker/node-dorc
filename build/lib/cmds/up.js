function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

var _require = require('child_process');

const spawn = _require.spawn;

const R = require('ramda');
const path = require('path');
const tryHook = require('../try-hook');
const build = require('./build');

var _require2 = require('figures-colored');

const tick = _require2.tick,
      cross = _require2.cross;

const prefixLines = require('prefix-stream-lines');
const format = require('chalk');
const connectLogs = require('./logs');

const dorcArgs = ['mode', 'hooks', 'image', 'command'];

const propTransforms = {
  volumes: value => {
    return value.map(v => {
      if (!path.isAbsolute(v)) {
        return ['-v', path.join(process.cwd(), v)];
      }
      return ['-v', value];
    });
  },
  env: value => R.toPairs(value).map(([k, v]) => ['-e', `${ k }=${ v }`]),
  ports: value => value.map(v => ['-p', v])
};

const getTransform = prop => {
  const transform = propTransforms[prop];
  if (!transform) {
    return (value, prop) => {
      if (Array.isArray(value)) {
        return value.map(v => ['--' + prop, v]);
      } else {
        return ['--' + prop, value];
      }
    };
  } else {
    return transform;
  }
};

const makeRunArgs = (service, containerName) => {
  const dockerRunProps = R.pipe(() => service, R.omit(dorcArgs), R.assoc('name', containerName), R.toPairs)();
  const options = dockerRunProps.map(([key, value]) => {
    return getTransform(key)(value, key);
  });
  const args = R.flatten([options, service.image, service.command || '']).filter(v => v);
  return args;
};

const startService = (service, containerName) => new Promise((resolve, reject) => {
  const args = ['run', '-d', ...makeRunArgs(service, containerName)];
  process.stdout.write(`  > docker ${ args.join(' ') }\n\n`);
  const p = spawn('docker', args);
  p.stderr.pipe(process.stderr);
  p.on('close', exitCode => {
    exitCode !== 0 ? reject(exitCode) : resolve();
  });
});

const startServices = (services, config) => Promise.all(R.pipe(R.toPairs, R.addIndex(R.map)(([name, service], idx) => {
  const containerName = `${ config.projectName }_${ name }`;
  return tryHook('before-up', service, name).then(() => startService(service, containerName)).then(() => {
    process.stdout.write(`${ tick } ${ name } is up\n`);
  }).catch(err => {
    process.stdout.write(`${ cross } could not start ${ name }\n`);
  });
}))(services));

const prepare = R.map(R.over(R.lensProp('image'), R.ifElse(R.is(String), R.identity, R.pipe(R.nth(-1), R.prop('tags'), R.nth(0)))));

const up = (() => {
  var _ref = _asyncToGenerator(function* (services, config, args) {
    yield build(services, config);
    return startServices(prepare(services), config, args).then(function () {
      if (args.detached !== true) {
        return connectLogs(services, config);
      }
    });
  });

  return function up(_x, _x2, _x3) {
    return _ref.apply(this, arguments);
  };
})();

module.exports = up;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvY21kcy91cC5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwic3Bhd24iLCJSIiwicGF0aCIsInRyeUhvb2siLCJidWlsZCIsInRpY2siLCJjcm9zcyIsInByZWZpeExpbmVzIiwiZm9ybWF0IiwiY29ubmVjdExvZ3MiLCJkb3JjQXJncyIsInByb3BUcmFuc2Zvcm1zIiwidm9sdW1lcyIsInZhbHVlIiwibWFwIiwidiIsImlzQWJzb2x1dGUiLCJqb2luIiwicHJvY2VzcyIsImN3ZCIsImVudiIsInRvUGFpcnMiLCJrIiwicG9ydHMiLCJnZXRUcmFuc2Zvcm0iLCJwcm9wIiwidHJhbnNmb3JtIiwiQXJyYXkiLCJpc0FycmF5IiwibWFrZVJ1bkFyZ3MiLCJzZXJ2aWNlIiwiY29udGFpbmVyTmFtZSIsImRvY2tlclJ1blByb3BzIiwicGlwZSIsIm9taXQiLCJhc3NvYyIsIm9wdGlvbnMiLCJrZXkiLCJhcmdzIiwiZmxhdHRlbiIsImltYWdlIiwiY29tbWFuZCIsImZpbHRlciIsInN0YXJ0U2VydmljZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwic3Rkb3V0Iiwid3JpdGUiLCJwIiwic3RkZXJyIiwib24iLCJleGl0Q29kZSIsInN0YXJ0U2VydmljZXMiLCJzZXJ2aWNlcyIsImNvbmZpZyIsImFsbCIsImFkZEluZGV4IiwibmFtZSIsImlkeCIsInByb2plY3ROYW1lIiwidGhlbiIsImNhdGNoIiwiZXJyIiwicHJlcGFyZSIsIm92ZXIiLCJsZW5zUHJvcCIsImlmRWxzZSIsImlzIiwiU3RyaW5nIiwiaWRlbnRpdHkiLCJudGgiLCJ1cCIsImRldGFjaGVkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7ZUFBZ0JBLFFBQVEsZUFBUixDOztNQUFUQyxLLFlBQUFBLEs7O0FBQ1AsTUFBTUMsSUFBSUYsUUFBUSxPQUFSLENBQVY7QUFDQSxNQUFNRyxPQUFPSCxRQUFRLE1BQVIsQ0FBYjtBQUNBLE1BQU1JLFVBQVVK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OztBQWVBLE1BQU1VLFVBQVUvRCxFQUFFYSxHQUFGLENBQ2RiLEVBQUVnRSxJQUFGLENBQ0VoRSxFQUFFaUUsUUFBRixDQUFXLE9BQVgsQ0FERixFQUVFakUsRUFBRWtFLE1BQUYsQ0FDRWxFLEVBQUVtRSxFQUFGLENBQUtDLE1BQUwsQ0FERixFQUVFcEUsRUFBRXFFLFFBRkosRUFHRXJFLEVBQUVnQyxJQUFGLENBQ0VoQyxFQUFFc0UsR0FBRixDQUFNLENBQUMsQ0FBUCxDQURGLEVBRUV0RSxFQUFFd0IsSUFBRixDQUFPLE1BQVAsQ0FGRixFQUdFeEIsRUFBRXNFLEdBQUYsQ0FBTSxDQUFOLENBSEYsQ0FIRixDQUZGLENBRGMsQ0FBaEI7O0FBZUEsTUFBTUM7QUFBQSwrQkFBSyxXQUFPbEIsUUFBUCxFQUFpQkMsTUFBakIsRUFBeUJqQixJQUF6QixFQUFrQztBQUMzQyxVQUFNbEMsTUFBTWtELFFBQU4sRUFBZ0JDLE1BQWhCLENBQU47QUFDQSxXQUFPRixjQUFjVyxRQUFRVixRQUFSLENBQWQsRUFBaUNDLE1BQWpDLEVBQXlDakIsSUFBekMsRUFDSnVCLElBREksQ0FDQyxZQUFNO0FBQ1YsVUFBSXZCLEtBQUttQyxRQUFMLEtBQWtCLElBQXRCLEVBQTRCO0FBQzFCLGVBQU9oRSxZQUFZNkMsUUFBWixFQUFzQkMsTUFBdEIsQ0FBUDtBQUNEO0FBQ0YsS0FMSSxDQUFQO0FBTUQsR0FSSzs7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFOOztBQVVBbUIsT0FBT0MsT0FBUCxHQUFpQkgsRUFBakIiLCJmaWxlIjoidXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7c3Bhd259ID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpXG5jb25zdCBSID0gcmVxdWlyZSgncmFtZGEnKVxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKVxuY29uc3QgdHJ5SG9vayA9IHJlcXVpcmUoJy4uL3RyeS1ob29rJylcbmNvbnN0IGJ1aWxkID0gcmVxdWlyZSgnLi9idWlsZCcpXG5jb25zdCB7dGljaywgY3Jvc3N9ID0gcmVxdWlyZSgnZmlndXJlcy1jb2xvcmVkJylcbmNvbnN0IHByZWZpeExpbmVzID0gcmVxdWlyZSgncHJlZml4LXN0cmVhbS1saW5lcycpXG5jb25zdCBmb3JtYXQgPSByZXF1aXJlKCdjaGFsaycpXG5jb25zdCBjb25uZWN0TG9ncyA9IHJlcXVpcmUoJy4vbG9ncycpXG5cbmNvbnN0IGRvcmNBcmdzID0gW1xuICAnbW9kZScsXG4gICdob29rcycsXG4gICdpbWFnZScsXG4gICdjb21tYW5kJ1xuXVxuXG5jb25zdCBwcm9wVHJhbnNmb3JtcyA9IHtcbiAgdm9sdW1lczogdmFsdWUgPT4ge1xuICAgIHJldHVybiB2YWx1ZS5tYXAodiA9PiB7XG4gICAgICBpZiAoIXBhdGguaXNBYnNvbHV0ZSh2KSkge1xuICAgICAgICByZXR1cm4gWyctdicsIHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB2KV1cbiAgICAgIH1cbiAgICAgIHJldHVybiBbJy12JywgdmFsdWVdXG4gICAgfSlcbiAgfSxcbiAgZW52OiB2YWx1ZSA9PiBSLnRvUGFpcnModmFsdWUpLm1hcCgoW2ssIHZdKSA9PiBbJy1lJywgYCR7a309JHt2fWBdKSxcbiAgcG9ydHM6IHZhbHVlID0+IHZhbHVlLm1hcCh2ID0+IFsnLXAnLCB2XSlcbn1cblxuY29uc3QgZ2V0VHJhbnNmb3JtID0gcHJvcCA9PiB7XG4gIGNvbnN0IHRyYW5zZm9ybSA9IHByb3BUcmFuc2Zvcm1zW3Byb3BdXG4gIGlmICghdHJhbnNmb3JtKSB7XG4gICAgcmV0dXJuICh2YWx1ZSwgcHJvcCkgPT4ge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZS5tYXAodiA9PiBbJy0tJyArIHByb3AsIHZdKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFsnLS0nICsgcHJvcCwgdmFsdWVdXG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJldHVybiB0cmFuc2Zvcm1cbiAgfVxufVxuXG5jb25zdCBtYWtlUnVuQXJncyA9IChzZXJ2aWNlLCBjb250YWluZXJOYW1lKSA9PiB7XG4gIGNvbnN0IGRvY2tlclJ1blByb3BzID0gUi5waXBlKFxuICAgICgpID0+IHNlcnZpY2UsXG4gICAgUi5vbWl0KGRvcmNBcmdzKSxcbiAgICBSLmFzc29jKCduYW1lJywgY29udGFpbmVyTmFtZSksXG4gICAgUi50b1BhaXJzXG4gICkoKVxuICBjb25zdCBvcHRpb25zID0gZG9ja2VyUnVuUHJvcHMubWFwKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICByZXR1cm4gZ2V0VHJhbnNmb3JtKGtleSkodmFsdWUsIGtleSlcbiAgfSlcbiAgY29uc3QgYXJncyA9IFIuZmxhdHRlbihbb3B0aW9ucywgc2VydmljZS5pbWFnZSwgc2VydmljZS5jb21tYW5kIHx8ICcnXSlcbiAgICAuZmlsdGVyKHYgPT4gdilcbiAgcmV0dXJuIGFyZ3Ncbn1cblxuY29uc3Qgc3RhcnRTZXJ2aWNlID0gKHNlcnZpY2UsIGNvbnRhaW5lck5hbWUpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgY29uc3QgYXJncyA9IFsncnVuJywgJy1kJywgLi4ubWFrZVJ1bkFyZ3Moc2VydmljZSwgY29udGFpbmVyTmFtZSldXG4gIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGAgID4gZG9ja2VyICR7YXJncy5qb2luKCcgJyl9XFxuXFxuYClcbiAgY29uc3QgcCA9IHNwYXduKCdkb2NrZXInLCBhcmdzKVxuICBwLnN0ZGVyci5waXBlKHByb2Nlc3Muc3RkZXJyKVxuICBwLm9uKCdjbG9zZScsIGV4aXRDb2RlID0+IHtcbiAgICBleGl0Q29kZSAhPT0gMCA/IHJlamVjdChleGl0Q29kZSkgOiByZXNvbHZlKClcbiAgfSlcbn0pXG5cbmNvbnN0IHN0YXJ0U2VydmljZXMgPSAoc2VydmljZXMsIGNvbmZpZykgPT4gUHJvbWlzZS5hbGwoUi5waXBlKFxuICBSLnRvUGFpcnMsXG4gIFIuYWRkSW5kZXgoUi5tYXApKChbbmFtZSwgc2VydmljZV0sIGlkeCkgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lck5hbWUgPSBgJHtjb25maWcucHJvamVjdE5hbWV9XyR7bmFtZX1gXG4gICAgcmV0dXJuIHRyeUhvb2soJ2JlZm9yZS11cCcsIHNlcnZpY2UsIG5hbWUpXG4gICAgICAudGhlbigoKSA9PiBzdGFydFNlcnZpY2Uoc2VydmljZSwgY29udGFpbmVyTmFtZSkpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGAke3RpY2t9ICR7bmFtZX0gaXMgdXBcXG5gKVxuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShgJHtjcm9zc30gY291bGQgbm90IHN0YXJ0ICR7bmFtZX1cXG5gKVxuICAgICAgfSlcbiAgfSlcbikoc2VydmljZXMpKVxuXG5jb25zdCBwcmVwYXJlID0gUi5tYXAoXG4gIFIub3ZlcihcbiAgICBSLmxlbnNQcm9wKCdpbWFnZScpLFxuICAgIFIuaWZFbHNlKFxuICAgICAgUi5pcyhTdHJpbmcpLFxuICAgICAgUi5pZGVudGl0eSxcbiAgICAgIFIucGlwZShcbiAgICAgICAgUi5udGgoLTEpLFxuICAgICAgICBSLnByb3AoJ3RhZ3MnKSxcbiAgICAgICAgUi5udGgoMClcbiAgICAgIClcbiAgICApXG4gIClcbilcblxuY29uc3QgdXAgPSBhc3luYyAoc2VydmljZXMsIGNvbmZpZywgYXJncykgPT4ge1xuICBhd2FpdCBidWlsZChzZXJ2aWNlcywgY29uZmlnKVxuICByZXR1cm4gc3RhcnRTZXJ2aWNlcyhwcmVwYXJlKHNlcnZpY2VzKSwgY29uZmlnLCBhcmdzKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGlmIChhcmdzLmRldGFjaGVkICE9PSB0cnVlKSB7XG4gICAgICAgIHJldHVybiBjb25uZWN0TG9ncyhzZXJ2aWNlcywgY29uZmlnKVxuICAgICAgfVxuICAgIH0pXG59XG5cbm1vZHVsZS5leHBvcnRzID0gdXBcbiJdfQ==