const R = require('ramda');
const spawnargs = require('parse-spawn-args').parse;

const wrapInArray = v => [v];
const ensureArray = R.ifElse(Array.isArray, R.identity, wrapInArray);

const normalizeImage = R.ifElse(R.compose(R.isNil, R.prop('image')), R.identity, R.over(R.lensProp('image'), R.ifElse(R.is(String), R.identity, R.pipe(ensureArray, R.map(R.over(R.lensProp('tag'), ensureArray))))));

const cmdToArray = R.ifElse(R.compose(R.isNil, R.prop('cmd')), R.assoc('cmd', []), R.over(R.lensProp('cmd'), spawnargs));

const normalize = (config, project) => R.over(R.lensProp('services'), R.pipe(R.map(R.pipe(normalizeImage, cmdToArray)), R.mapObjIndexed((v, k, obj) => ({
  name: k,
  container: `${ project.name }_${ k }`,
  config: v
}))))(config);

module.exports = normalize;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvbm9ybWFsaXplLWNvbmZpZy5qcyJdLCJuYW1lcyI6WyJSIiwicmVxdWlyZSIsInNwYXduYXJncyIsInBhcnNlIiwid3JhcEluQXJyYXkiLCJ2IiwiZW5zdXJlQXJyYXkiLCJpZkVsc2UiLCJBcnJheSIsImlzQXJyYXkiLCJpZGVudGl0eSIsIm5vcm1hbGl6ZUltYWdlIiwiY29tcG9zZSIsImlzTmlsIiwicHJvcCIsIm92ZXIiLCJsZW5zUHJvcCIsImlzIiwiU3RyaW5nIiwicGlwZSIsIm1hcCIsImNtZFRvQXJyYXkiLCJhc3NvYyIsIm5vcm1hbGl6ZSIsImNvbmZpZyIsInByb2plY3QiLCJtYXBPYmpJbmRleGVkIiwiayIsIm9iaiIsIm5hbWUiLCJjb250YWluZXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxJQUFJQyxRQUFRLE9BQVIsQ0FBVjtBQUNBLE1BQU1DLFlBQVlELFFBQVEsa0JBQVIsRUFBNEJFLEtBQTlDOztBQUVBLE1BQU1DLGNBQWVDLENBQUQsSUFBTyxDQUFDQSxDQUFELENBQTNCO0FBQ0EsTUFBTUMsY0FBY04sRUFBRU8sTUFBRixDQUFTQyxNQUFNQyxPQUFmLEVBQXdCVCxFQUFFVSxRQUExQixFQUFvQ04sV0FBcEMsQ0FBcEI7O0FBRUEsTUFBTU8saUJBQWlCWCxFQUFFTyxNQUFGLENBQ3JCUCxFQUFFWSxPQUFGLENBQVVaLEVBQUVhLEtBQVosRUFBbUJiLEVBQUVjLElBQUYsQ0FBTyxPQUFQLENBQW5CLENBRHFCLEVBRXJCZCxFQUFFVSxRQUZtQixFQUdyQlYsRUFBRWUsSUFBRixDQUFPZixFQUFFZ0IsUUFBRixDQUFXLE9BQVgsQ0FBUCxFQUE0QmhCLEVBQUVPLE1BQUYsQ0FDMUJQLEVBQUVpQixFQUFGLENBQUtDLE1BQUwsQ0FEMEIsRUFFMUJsQixFQUFFVSxRQUZ3QixFQUcxQlYsRUFBRW1CLElBQUYsQ0FDRWIsV0FERixFQUVFTixFQUFFb0IsR0FBRixDQUFNcEIsRUFBRWUsSUFBRixDQUFPZixFQUFFZ0IsUUFBRixDQUFXLEtBQVgsQ0FBUCxFQUEwQlYsV0FBMUIsQ0FBTixDQUZGLENBSDBCLENBQTVCLENBSHFCLENBQXZCOztBQWFBLE1BQU1lLGFBQWFyQixFQUFFTyxNQUFGLENBQ2pCUCxFQUFFWSxPQUFGLENBQVVaLEVBQUVhLEtBQVosRUFBbUJiLEVBQUVjLElBQUYsQ0FBTyxLQUFQLENBQW5CLENBRGlCLEVBRWpCZCxFQUFFc0IsS0FBRixDQUFRLEtBQVIsRUFBZSxFQUFmLENBRmlCLEVBR2pCdEIsRUFBRWUsSUFBRixDQUFPZixFQUFFZ0IsUUFBRixDQUFXLEtBQVgsQ0FBUCxFQUEwQmQsU0FBMUIsQ0FIaUIsQ0FBbkI7O0FBTUEsTUFBTXFCLFlBQVksQ0FBQ0MsTUFBRCxFQUFTQyxPQUFULEtBQXFCekIsRUFBRWUsSUFBRixDQUNyQ2YsRUFBRWdCLFFBQUYsQ0FBVyxVQUFYLENBRHFDLEVBRXJDaEIsRUFBRW1CLElBQUYsQ0FDRW5CLEVBQUVvQixHQUFGLENBQU1wQixFQUFFbUIsSUFBRixDQUFPUixjQUFQLEVBQXVCVSxVQUF2QixDQUFOLENBREYsRUFFRXJCLEVBQUUwQixhQUFGLENBQWdCLENBQUNyQixDQUFELEVBQUlzQixDQUFKLEVBQU9DLEdBQVAsTUFBZ0I7QUFDOUJDLFFBQU1GLENBRHdCO0FBRTlCRyxhQUFZLElBQUVMLFFBQVFJLElBQUssTUFBR0YsQ0FBRSxHQUZGO0FBRzlCSCxVQUFRbkI7QUFIc0IsQ0FBaEIsQ0FBaEIsQ0FGRixDQUZxQyxFQVVyQ21CLE1BVnFDLENBQXZDOztBQVlBTyxPQUFPQyxPQUFQLEdBQWlCVCxTQUFqQiIsImZpbGUiOiJub3JtYWxpemUtY29uZmlnLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUiA9IHJlcXVpcmUoJ3JhbWRhJylcbmNvbnN0IHNwYXduYXJncyA9IHJlcXVpcmUoJ3BhcnNlLXNwYXduLWFyZ3MnKS5wYXJzZVxuXG5jb25zdCB3cmFwSW5BcnJheSA9ICh2KSA9PiBbdl1cbmNvbnN0IGVuc3VyZUFycmF5ID0gUi5pZkVsc2UoQXJyYXkuaXNBcnJheSwgUi5pZGVudGl0eSwgd3JhcEluQXJyYXkpXG5cbmNvbnN0IG5vcm1hbGl6ZUltYWdlID0gUi5pZkVsc2UoXG4gIFIuY29tcG9zZShSLmlzTmlsLCBSLnByb3AoJ2ltYWdlJykpLFxuICBSLmlkZW50aXR5LFxuICBSLm92ZXIoUi5sZW5zUHJvcCgnaW1hZ2UnKSwgUi5pZkVsc2UoXG4gICAgUi5pcyhTdHJpbmcpLFxuICAgIFIuaWRlbnRpdHksXG4gICAgUi5waXBlKFxuICAgICAgZW5zdXJlQXJyYXksXG4gICAgICBSLm1hcChSLm92ZXIoUi5sZW5zUHJvcCgndGFnJyksIGVuc3VyZUFycmF5KSlcbiAgICApXG4gICkpXG4pXG5cbmNvbnN0IGNtZFRvQXJyYXkgPSBSLmlmRWxzZShcbiAgUi5jb21wb3NlKFIuaXNOaWwsIFIucHJvcCgnY21kJykpLFxuICBSLmFzc29jKCdjbWQnLCBbXSksXG4gIFIub3ZlcihSLmxlbnNQcm9wKCdjbWQnKSwgc3Bhd25hcmdzKVxuKVxuXG5jb25zdCBub3JtYWxpemUgPSAoY29uZmlnLCBwcm9qZWN0KSA9PiBSLm92ZXIoXG4gIFIubGVuc1Byb3AoJ3NlcnZpY2VzJyksXG4gIFIucGlwZShcbiAgICBSLm1hcChSLnBpcGUobm9ybWFsaXplSW1hZ2UsIGNtZFRvQXJyYXkpKSxcbiAgICBSLm1hcE9iakluZGV4ZWQoKHYsIGssIG9iaikgPT4gKHtcbiAgICAgIG5hbWU6IGssXG4gICAgICBjb250YWluZXI6IGAke3Byb2plY3QubmFtZX1fJHtrfWAsXG4gICAgICBjb25maWc6IHZcbiAgICB9KSlcbiAgKVxuKShjb25maWcpXG5cbm1vZHVsZS5leHBvcnRzID0gbm9ybWFsaXplXG4iXX0=